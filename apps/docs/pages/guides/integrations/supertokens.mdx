import Layout from '~/layouts/DefaultGuideLayout'

export const meta = {
  id: 'supertokens',
  title: 'SuperTokens',
  description:
    'åˆ›å»ºä¸€ä¸ªç”±SuperTokenså’ŒPostgreSQLè¡Œçº§å®‰å…¨ä¿éšœçš„Next.jsåº”ç”¨ç¨‹åºã€‚',
}

[SuperTokens](https://www.supertokens.com)æ˜¯ä¸€ä¸ªå¼€æºçš„è®¤è¯è§£å†³æ–¹æ¡ˆï¼Œä¸ºè®¤è¯å’Œç®¡ç†ç”¨æˆ·æä¾›è®¸å¤šç­–ç•¥ã€‚ä½ å¯ä»¥ä½¿ç”¨ç®¡ç†æœåŠ¡æ¥è¿›è¡Œç®€å•çš„è®¾ç½®ï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œæ‰˜ç®¡è¯¥è§£å†³æ–¹æ¡ˆä»¥å®Œå…¨æ§åˆ¶ä½ çš„æ•°æ®ã€‚

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨SuperTokensã€Supabaseå’ŒNext.jsæ„å»ºä¸€ä¸ªç®€å•çš„Webåº”ç”¨ç¨‹åºã€‚ä½ å°†èƒ½å¤Ÿä½¿ç”¨SuperTokensè¿›è¡Œæ³¨å†Œï¼Œä½ çš„ç”µå­é‚®ä»¶å’Œç”¨æˆ·IDå°†è¢«å­˜å‚¨åœ¨Supabaseä¸­ã€‚ä¸€æ—¦é€šè¿‡è®¤è¯ï¼Œå‰ç«¯å°†èƒ½å¤ŸæŸ¥è¯¢Supabaseå¹¶æ£€ç´¢ç”¨æˆ·çš„ç”µå­é‚®ä»¶ã€‚æˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºå°†ä½¿ç”¨[ç”µå­é‚®ä»¶-å¯†ç å’Œç¤¾äº¤ç™»å½•](https://supertokens.com/docs/thirdpartyemailpassword/introduction)é…æ–¹è¿›è¡Œè®¤è¯å’Œä¼šè¯ç®¡ç†ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨Supabaseæ¥å­˜å‚¨å’Œæˆæƒå¯¹ç”¨æˆ·æ•°æ®çš„è®¿é—®ã€‚Supabaseä½¿å¾—è®¾ç½®è¡Œçº§å®‰å…¨(RLS)ç­–ç•¥å˜å¾—éå¸¸ç®€å•ï¼Œå®ƒå¯ä»¥ç¡®ä¿ç”¨æˆ·åªèƒ½è¯»å†™å±äºä»–ä»¬çš„æ•°æ®ã€‚

###æ¼”ç¤ºåº”ç”¨ç¨‹åº

ä½ å¯ä»¥åœ¨[Github](https://github.com/supertokens/supertokens-auth-react/tree/master/examples/with-supabase)ä¸Šæ‰¾åˆ°ä¸€ä¸ªä½¿ç”¨SuperTokensã€Supabaseå’ŒNexts.jsçš„æ¼”ç¤ºåº”ç”¨ç¨‹åºã€‚

## æ­¥éª¤1ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Supabaseé¡¹ç›®

åœ¨ä½ çš„[Supabaseä»ªè¡¨æ¿](https://app.supabase.com/)ä¸Šï¼Œç‚¹å‡»`æ–°é¡¹ç›®'ã€‚

ä¸ºä½ çš„Supabaseé¡¹ç›®è¾“å…¥ä¸€ä¸ª`åç§°'ã€‚

è¾“å…¥ä¸€ä¸ªå®‰å…¨çš„ "æ•°æ®åº“å¯†ç "ã€‚

é€‰æ‹©ä½ çš„åº”ç”¨ç¨‹åºåå°æ‰€åœ¨çš„åŒä¸€ä¸ª "åŒºåŸŸ"ã€‚

ç‚¹å‡» `åˆ›å»ºæ–°é¡¹ç›®`ã€‚

![New Supabase project settings](/docs/img/guides/integrations/supertokens/supabase_dashboard_create.png)

## ç¬¬2æ­¥ï¼šåœ¨Supabaseä¸­åˆ›å»ºè¡¨

åœ¨[Supabaseä»ªè¡¨æ¿](https://app.supabase.com/)çš„ä¾§è¾¹æ èœå•ä¸­ï¼Œç‚¹å‡» `è¡¨ç¼–è¾‘å™¨`ï¼Œç„¶åç‚¹å‡» `æ–°å»ºè¡¨`ã€‚

è¾“å…¥`users`ä½œä¸º`åç§°`å­—æ®µã€‚

é€‰æ‹© `å¯ç”¨è¡Œçº§å®‰å…¨ï¼ˆRLS`ã€‚

åˆ é™¤é»˜è®¤åˆ—

åˆ›å»ºä¸¤ä¸ªæ–°åˆ—ã€‚

- `user_id`ä¸º`varchar`ï¼Œä½œä¸ºä¸»é”®
- `email`ä¸º`varchar`ã€‚

ç‚¹å‡» `ä¿å­˜`æ¥åˆ›å»ºæ–°è¡¨ã€‚

![Users table](/docs/img/guides/integrations/supertokens/supabase_table_create.png)

## ç¬¬ä¸‰æ­¥ï¼šç”¨SuperTokensè®¾ç½®ä½ çš„Next.jsåº”ç”¨ç¨‹åºã€‚

ç”±äºæœ¬æŒ‡å—çš„èŒƒå›´ä»…é™äº SuperTokens å’Œ Supabase ä¹‹é—´çš„é›†æˆï¼Œæ‚¨å¯ä»¥å‚è€ƒ SuperTokens ç½‘ç«™ï¼ŒæŸ¥çœ‹ [å¦‚ä½•ç”¨ SuperTokens è®¾ç½®æ‚¨çš„ Next.js åº”ç”¨ç¨‹åº](https://supertokens.com/docs/thirdpartyemailpassword/nextjs/about)ã€‚

ä¸€æ—¦ä½ å®Œæˆäº†åº”ç”¨çš„è®¾ç½®ï¼Œä½ å°†çœ‹åˆ°ä»¥ä¸‹å±å¹•

![SuperTokens Auth Screen](/docs/img/guides/integrations/supertokens/supertokens_thirdpartyemailpassword_auth_screen.png)

## ç¬¬4æ­¥ï¼šåˆ›å»ºä¸€ä¸ªSupabase JWTæ¥è®¿é—®Supabase

åœ¨æˆ‘ä»¬çš„ Nextjs åº”ç”¨ç¨‹åºä¸­ï¼Œå½“ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ Supabase ä¸­å­˜å‚¨ç”¨æˆ·çš„ç”µå­é‚®ä»¶ã€‚ç„¶åæˆ‘ä»¬å°†ä»Supabaseä¸­æ£€ç´¢è¯¥ç”µå­é‚®ä»¶ï¼Œå¹¶åœ¨æˆ‘ä»¬çš„å‰ç«¯æ˜¾ç¤ºå®ƒã€‚

è¦ä½¿ç”¨Supabaseå®¢æˆ·ç«¯æ¥æŸ¥è¯¢æ•°æ®åº“ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç”¨Supabaseåº”ç”¨ç¨‹åºçš„ç­¾åç§˜å¯†ç­¾åçš„JWTã€‚è¿™ä¸ªJWTè¿˜éœ€è¦åŒ…å«ç”¨æˆ·çš„userIdï¼Œä»¥ä¾¿SupabaseçŸ¥é“æœ‰ä¸€ä¸ªç»è¿‡è®¤è¯çš„ç”¨æˆ·åœ¨å‘å‡ºè¯·æ±‚ã€‚

ä¸ºäº†åˆ›å»ºè¿™ä¸ªæµç¨‹ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ SuperTokensï¼Œä»¥ä¾¿åœ¨ç”¨æˆ·æ³¨å†Œæˆ–ç™»å½•æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªç”¨ Supabase çš„ç­¾åç§˜å¯†ç­¾åçš„ JWTï¼Œå¹¶é™„åŠ åˆ°ç”¨æˆ·çš„ä¼šè¯ä¸­ã€‚å°†JWTé™„åŠ åˆ°ç”¨æˆ·çš„ä¼šè¯ä¸Šå°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨å‰ç«¯å’Œåç«¯ï¼ˆä¼šè¯åéªŒè¯ï¼‰æ£€ç´¢Supabase JWTï¼Œä½¿ç”¨å®ƒæˆ‘ä»¬å¯ä»¥æŸ¥è¯¢Supabaseã€‚

æˆ‘ä»¬å¸Œæœ›åœ¨åˆ›å»ºSuperTokensçš„ä¼šè¯æ—¶åˆ›å»ºä¸€ä¸ªSupabase JWTã€‚è¿™å¯ä»¥é€šè¿‡åœ¨ä½ çš„åç«¯é…ç½®ä¸­è¦†ç›–`createNewSession`å‡½æ•°æ¥å®ç°ã€‚

```ts
// config/backendConfig.ts

import ThirdPartyEmailPasswordNode from "supertokens-node/recipe/thirdpartyemailpassword";
import SessionNode from "supertokens-node/recipe/session";
import { TypeInput } from "supertokens-node/lib/build/types";
import { appInfo } from "./appInfo";
import jwt from "jsonwebtoken";

let backendConfig = (): TypeInput => {
    return {
        framework: "express",
        supertokens: {
            connectionURI: "https://try.supertokens.com",
        },
        appInfo,
        recipeList: [
            ThirdPartyEmailPasswordNode.init({...}),
            SessionNode.init({
                override: {
                    functions: (originalImplementation) => {
                        return {
                            ...originalImplementation,
                            // We want to create a JWT which contains the users userId signed with Supabase's secret so
                            // it can be used by Supabase to validate the user when retrieving user data from their service.
                            // We store this token in the accessTokenPayload so it can be accessed on the frontend and on the backend.
                            createNewSession: async function (input) {
                                const payload = {
                                    userId: input.userId,
                                    exp: Math.floor(Date.now() / 1000) + 60 * 60,
                                };

                                const supabase_jwt_token = jwt.sign(payload, process.env.SUPABASE_SIGNING_SECRET);

                                input.accessTokenPayload = {
                                    ...input.accessTokenPayload,
                                    supabase_token: supabase_jwt_token,
                                };

                                return await originalImplementation.createNewSession(input);
                            },
                        };
                    },
                },
            }),
        ],
        isInServerlessEnv: true,
    };
};

```

å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`jsonwebtoken`åº“æ¥åˆ›å»ºä¸€ä¸ªç”¨Supabaseçš„ç­¾åç§˜å¯†ç­¾åçš„JWTï¼Œå…¶æœ‰æ•ˆè½½è·åŒ…å«ç”¨æˆ·çš„userIdã€‚

æˆ‘ä»¬å°†æŠŠè¿™ä¸ªä»¤ç‰Œå­˜å‚¨åœ¨`accessTokenPayload`ä¸­ï¼Œè¿™åŸºæœ¬ä¸Šå…è®¸æˆ‘ä»¬åœ¨ç”¨æˆ·ç™»å½•æ—¶åœ¨å‰ç«¯å’Œåç«¯è®¿é—®`supabase_token`ã€‚

## ç¬¬äº”æ­¥: åˆ›å»ºä¸€ä¸ªSupabaseå®¢æˆ·ç«¯

åˆ›å»ºä¸€ä¸ªåä¸º`utils/supabase.ts`çš„æ–°æ–‡ä»¶å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ã€‚

```ts
// utils/supabase.ts

import { createClient } from '@supabase/supabase-js'

const getSupabase = (access_token) => {
  const supabase = createClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL,
    process.env.NEXT_PUBLIC_SUPABASE_KEY
  )

  supabase.auth.session = () => ({
    access_token,
  })

  return supabase
}

export { getSupabase }
```

è¿™å°†æ˜¯æˆ‘ä»¬ä¸Supabaseå¯¹è¯çš„å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬å¯ä»¥ä¼ é€’ç»™å®ƒä¸€ä¸ª`access_token'ï¼Œå®ƒå°†è¢«é™„åŠ åˆ°æˆ‘ä»¬çš„è¯·æ±‚ä¸­ã€‚è¿™ä¸ª`access_token`ä¸æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„`supabase_token`ç›¸åŒã€‚

## ç¬¬6æ­¥ï¼šå½“ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œå°†å…¶æ’å…¥Supabaseä¸­ã€‚

åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥æ³¨å†Œç”¨æˆ·ã€‚ç”µå­é‚®ä»¶-å¯†ç å’ŒåŸºäºç¤¾ä¼šç™»å½•çš„è®¤è¯ã€‚æˆ‘ä»¬å°†éœ€è¦è¦†ç›–è¿™ä¸¤ä¸ªAPIï¼Œä»¥ä¾¿å½“ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œä»–ä»¬çš„ç”µå­é‚®ä»¶æ˜ å°„åˆ°ä»–ä»¬çš„userIdè¢«å­˜å‚¨åœ¨Supabaseä¸­ã€‚

```ts
// config/backendConfig.ts

import ThirdPartyEmailPasswordNode from "supertokens-node/recipe/thirdpartyemailpassword";
import SessionNode from "supertokens-node/recipe/session";
import { TypeInput } from "supertokens-node/lib/build/types";
import { appInfo } from "./appInfo";
import jwt from "jsonwebtoken";
import { getSupabase } from "../utils/supabase";

let backendConfig = (): TypeInput => {
    return {
        framework: "express",
        supertokens: {
            connectionURI: "https://try.supertokens.com",
        },
        appInfo,
        recipeList: [
            ThirdPartyEmailPasswordNode.init({
                providers: [...],
                override: {
                    apis: (originalImplementation) => {
                        return {
                            ...originalImplementation,
                            // the thirdPartySignInUpPost function handles sign up/in via Social login
                            thirdPartySignInUpPOST: async function (input) {
                                if (originalImplementation.thirdPartySignInUpPOST === undefined) {
                                    throw Error("Should never come here");
                                }

                                // call the sign up/in api for social login
                                let response = await originalImplementation.thirdPartySignInUpPOST(input);

                                // check that there is no issue with sign up and that a new user is created
                                if (response.status === "OK" && response.createdNewUser) {

                                    // retrieve the accessTokenPayload from the user's session
                                    const accessTokenPayload = response.session.getAccessTokenPayload();

                                    // create a supabase client with the supabase_token from the accessTokenPayload
                                    const supabase = getSupabase(accessTokenPayload.supabase_token);

                                    // store the user's email mapped to their userId in Supabase
                                    const { error } = await supabase
                                        .from("users")
                                        .insert({ email: response.user.email, user_id: response.user.id });

                                    if (error !== null) {

                                        throw error;
                                    }
                                }

                                return response;
                            },
                            // the emailPasswordSignUpPOST function handles sign up via Email-Password
                            emailPasswordSignUpPOST: async function (input) {
                                if (originalImplementation.emailPasswordSignUpPOST === undefined) {
                                    throw Error("Should never come here");
                                }

                                let response = await originalImplementation.emailPasswordSignUpPOST(input);

                                if (response.status === "OK") {

                                    // retrieve the accessTokenPayload from the user's session
                                    const accessTokenPayload = response.session.getAccessTokenPayload();

                                    // create a supabase client with the supabase_token from the accessTokenPayload
                                    const supabase = getSupabase(accessTokenPayload.supabase_token);

                                    // store the user's email mapped to their userId in Supabase
                                    const { error } = await supabase
                                        .from("users")
                                        .insert({ email: response.user.email, user_id: response.user.id });

                                    if (error !== null) {

                                        throw error;
                                    }
                                }

                                return response;
                            },
                        };
                    },
                },
            }),
            SessionNode.init({...}),
        ],
        isInServerlessEnv: true,
    };
};

```

å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å°†è¦†ç›–`emailPasswordSignUpPOST`å’Œ`thirdPartySignInUpPOST`APIï¼Œè¿™æ ·ï¼Œå¦‚æœä¸€ä¸ªç”¨æˆ·æ³¨å†Œï¼Œæˆ‘ä»¬ä»ç”¨æˆ·çš„accessTokenPayloadä¸­æ£€ç´¢Supabase JWTï¼ˆæˆ‘ä»¬åœ¨`createNewSession'å‡½æ•°ä¸­åˆ›å»ºï¼‰ï¼Œå¹¶å‘Supabaseå‘é€è¯·æ±‚ï¼Œæ’å…¥email-useridçš„æ˜ å°„ã€‚

## ç¬¬ä¸ƒæ­¥ï¼šåœ¨å‰å°æ£€ç´¢ç”¨æˆ·çš„ç”µå­é‚®ä»¶

ç°åœ¨æˆ‘ä»¬çš„åç«¯å·²ç»è®¾ç½®å¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹æˆ‘ä»¬çš„å‰ç«¯æ¥ä»Supabaseä¸­æ£€ç´¢ç”¨æˆ·çš„ç”µå­é‚®ä»¶ã€‚

```tsx
// pages/index.tsx

import React, { useState, useEffect } from 'react'
import Head from 'next/head'
import styles from '../styles/Home.module.css'
import ThirdPartyEmailPassword, {
  ThirdPartyEmailPasswordAuth,
} from 'supertokens-auth-react/recipe/thirdpartyemailpassword'
import dynamic from 'next/dynamic'
import { useSessionContext } from 'supertokens-auth-react/recipe/session'
import { getSupabase } from '../utils/supabase'

export default function Home() {
  return (
    // We will wrap the ProtectedPage component with ThirdPartyEmailPasswordAuth so only an
    // authenticated user can access it. This will also allow us to access the users session information
    // within the component.
    <ThirdPartyEmailPasswordAuth>
      <ProtectedPage />
    </ThirdPartyEmailPasswordAuth>
  )
}

function ProtectedPage() {
  // retrieve the authenticated user's accessTokenPayload and userId from the sessionContext
  const { accessTokenPayload, userId } = useSessionContext()

  if (sessionContext.loading === true) {
    return null
  }

  const [userEmail, setEmail] = useState('')
  useEffect(() => {
    async function getUserEmail() {
      // retrieve the supabase client who's JWT contains users userId, this will be
      // used by supabase to check that the user can only access table entries which contain their own userId
      const supabase = getSupabase(accessTokenPayload.supabase_token)

      // retrieve the user's name from the users table whose email matches the email in the JWT
      const { data } = await supabase.from('users').select('email').eq('user_id', userId)

      if (data.length > 0) {
        setEmail(data[0].email)
      }
    }
    getUserEmail()
  }, [])

  return (
    <div className={styles.container}>
      <Head>
        <title>SuperTokens ğŸ’«</title>
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className={styles.main}>
        <p className={styles.description}>
          You are authenticated with SuperTokens! (UserId: {userId})
          <br />
          Your email retrieved from Supabase: {userEmail}
        </p>
      </main>
    </div>
  )
}
```

å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨SuperTokensçš„`useSessionContext`é’©å­æ¥æ£€ç´¢å·²è®¤è¯ç”¨æˆ·çš„`userId`å’Œ`accessTokenPayload`ã€‚ä½¿ç”¨Reactçš„`useEffect`é’©å­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Supabaseå®¢æˆ·ç«¯ï¼Œä½¿ç”¨ä»ç”¨æˆ·çš„`accessTokenPayload`ä¸­è·å–çš„JWTå’Œä»–ä»¬çš„`userId`ï¼Œä»Supabaseä¸­è·å–ç”¨æˆ·çš„ç”µå­é‚®ä»¶ã€‚

## ç¬¬8æ­¥: åˆ›å»ºç­–ç•¥æ¥æ‰§è¡Œé€‰æ‹©å’Œæ’å…¥è¯·æ±‚çš„è¡Œçº§å®‰å…¨

ä¸ºäº†æ‰§è¡Œ `Users`è¡¨çš„è¡Œçº§å®‰å…¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºé€‰æ‹©å’Œæ’å…¥è¯·æ±‚åˆ›å»ºç­–ç•¥ã€‚

è¿™äº›ç­–ç•¥å°†ä»JWTä¸­è·å–ç”¨æˆ·èº«ä»½ï¼Œå¹¶æ£€æŸ¥å®ƒæ˜¯å¦ä¸Supabaseè¡¨ä¸­çš„ç”¨æˆ·èº«ä»½ç›¸ç¬¦ã€‚

è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†éœ€è¦ä¸€ä¸ªPostgreSQLå‡½æ•°æ¥ä»JWTä¸­æå–userIdã€‚

JWTä¸­çš„æœ‰æ•ˆè½½è·å°†æœ‰ä»¥ä¸‹ç»“æ„ã€‚

```
// JWT payload
{
    userId,
    exp
}
```

è¦åˆ›å»ºPostgreSQLåŠŸèƒ½ï¼Œè®©æˆ‘ä»¬å›åˆ°Supabaseä»ªè¡¨æ¿ï¼Œä»ä¾§è¾¹æ èœå•ä¸­é€‰æ‹©`SQL`ï¼Œç„¶åç‚¹å‡»`æ–°æŸ¥è¯¢`ã€‚è¿™å°†åˆ›å»ºä¸€ä¸ªæ–°çš„æŸ¥è¯¢ï¼Œç§°ä¸º `æ–°sqlç‰‡æ®µ`ï¼Œè¿™å°†å…è®¸æˆ‘ä»¬å¯¹Postgresæ•°æ®åº“è¿è¡Œä»»ä½•SQLã€‚

å†™ä¸‹ä»¥ä¸‹å†…å®¹å¹¶ç‚¹å‡»`è¿è¡Œ`ã€‚

```sql
create or replace function auth.user_id() returns text as $$
  select nullif(current_setting('request.jwt.claims', true)::json->>'userId', '')::text;
$$ language sql stable;
```

è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º`auth.user_id()`çš„å‡½æ•°ï¼Œå®ƒå°†æ£€æŸ¥æˆ‘ä»¬JWTæœ‰æ•ˆè½½è·ä¸­çš„`userId`å­—æ®µã€‚

### SELECTæŸ¥è¯¢ç­–ç•¥

æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç­–ç•¥å°†æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ˜¯ç”µå­é‚®ä»¶çš„æ‰€æœ‰è€…ã€‚

ä»Supabaseä¾§è¾¹æ èœå•ä¸­é€‰æ‹©`Authentication`ï¼Œç‚¹å‡»`Policies`ï¼Œç„¶ååœ¨`Users`è¡¨ä¸­é€‰æ‹©`New Policy`ã€‚

![Create new policy](/docs/img/guides/integrations/supertokens/create_policy.png)

åœ¨æ¨¡å¼ä¸­ï¼Œé€‰æ‹© `ä»å¤´åˆ›å»ºä¸€ä¸ªæ”¿ç­–`ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ã€‚

![Policy settings for SELECT](/docs/img/guides/integrations/supertokens/policy_config_select.png)

è¿™ä¸ªç­–ç•¥æ˜¯è°ƒç”¨æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„PostgreSQLå‡½æ•°æ¥è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ID`auth.user_id()`ï¼Œå¹¶æ£€æŸ¥è¿™æ˜¯å¦ä¸å½“å‰`email`çš„`user_id`åˆ—åŒ¹é…ã€‚å¦‚æœåŒ¹é…ï¼Œé‚£ä¹ˆå®ƒå°†å…è®¸ç”¨æˆ·é€‰æ‹©ï¼Œå¦åˆ™å°†ç»§ç»­æ‹’ç»ã€‚

ç‚¹å‡» `Review`ï¼Œç„¶åç‚¹å‡» "ä¿å­˜ç­–ç•¥"ã€‚

### INSERTæŸ¥è¯¢ç­–ç•¥

æˆ‘ä»¬çš„ç¬¬äºŒä¸ªç­–ç•¥å°†æ£€æŸ¥æ­£åœ¨æ’å…¥çš„`user_id`æ˜¯å¦ä¸JWTä¸­çš„`userId`ç›¸åŒã€‚

åˆ›å»ºå¦ä¸€ä¸ªç­–ç•¥å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ã€‚

![Policy settings for INSERT](/docs/img/guides/integrations/supertokens/policy_config_insert.png)

ä¸ä¹‹å‰çš„ç­–ç•¥ç±»ä¼¼ï¼Œæˆ‘ä»¬æ­£åœ¨è°ƒç”¨æˆ‘ä»¬åˆ›å»ºçš„PostgreSQLå‡½æ•°æ¥è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ID`auth.user_id()`å¹¶æ£€æŸ¥å®ƒæ˜¯å¦ä¸æˆ‘ä»¬è¯•å›¾æ’å…¥çš„è¡Œçš„`user_id`åˆ—ç›¸åŒ¹é…ã€‚å¦‚æœåŒ¹é…ï¼Œé‚£ä¹ˆå®ƒå°†å…è®¸ç”¨æˆ·æ’å…¥è¯¥è¡Œï¼Œå¦åˆ™å®ƒå°†ç»§ç»­æ‹’ç»ã€‚

ç‚¹å‡» `Review`ï¼Œç„¶åç‚¹å‡» "ä¿å­˜ç­–ç•¥"ã€‚

## ç¬¬ä¹æ­¥ï¼šæµ‹è¯•ä½ çš„å˜åŒ–

ä½ ç°åœ¨å¯ä»¥æ³¨å†Œäº†ï¼Œä½ åº”è¯¥çœ‹åˆ°ä»¥ä¸‹å±å¹•ã€‚

![SuperTokens App Authenticated](/docs/img/guides/integrations/supertokens/supabase_app_authenticated_screen.png)

å¦‚æœä½ å¯¼èˆªåˆ°ä½ çš„è¡¨ï¼Œä½ åº”è¯¥çœ‹åˆ°ä¸€ä¸ªæ–°çš„è¡Œï¼Œä¸Šé¢æœ‰ç”¨æˆ·çš„`user_id`å’Œ`email`ã€‚

![Supabase Users table](/docs/img/guides/integrations/supertokens/table_with_user.png)

## èµ„æº

- [SuperTokens](https://supertokens.com/) å®˜æ–¹ç½‘ç«™ã€‚
- [SuperTokensç¤¾åŒº](https://supertokens.com/discord)ã€‚
- [SuperTokensæ–‡æ¡£](https://supertokens.com/docs/guides)ã€‚

export const Page = ({ children }) => <Layout meta={meta} children={children} />

export default Page
